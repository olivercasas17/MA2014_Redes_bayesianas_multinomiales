---
title: "Redes bayesianas multinomiales"
author: ""
date: today
format:
  pdf:
    toc: true
    toc-depth: 3
    number-sections: true
    number-depth: 3
    fontsize: 11pt
    linestretch: 1.5
    geometry: margin=2.5cm
    papersize: a4
    fig-width: 6
    fig-height: 4
    fig-pos: "H"
    code-line-numbers: true
    keep-tex: true
    documentclass: article
    mainfont: Times New Roman
    monofont: Courier New
    sansfont: Arial
editor: source
  markdown: 
    wrap: 72
---

### Abstract

Este estudio analiza patrones de movilidad urbana a partir de la Encuesta Origen–Destino 2017 utilizando redes bayesianas multinomiales. El objetivo principal es modelar las dependencias entre variables sociodemográficas, de transporte y de viaje para estimar probabilidades condicionales relevantes en el análisis de movilidad. La metodología consistió en la construcción de grafos acíclicos dirigidos (DAG), uno basado en conocimiento previo y otro generado mediante el algoritmo de hill climbing. Ambos modelos fueron evaluados con métricas estadísticas como el Criterio de Información de Akaike (AIC) y el Criterio de Información Bayesiano (BIC). Los resultados muestran que el modelo aprendido con hill climbing obtuvo un mejor ajuste, por lo que se utilizó para realizar inferencia probabilística mediante consultas condicionales (queries). Los hallazgos permiten identificar, por ejemplo, la influencia de la localidad y el propósito del viaje en la elección del transporte, así como diferencias significativas en la duración de los viajes según el tamaño de la localidad. En conclusión, las redes bayesianas se muestran como una herramienta útil para explorar y predecir patrones de movilidad en contextos urbanos complejos.

### Introducción

El estudio de la movilidad urbana es un componente esencial para comprender la dinámica de las ciudades y apoyar la toma de decisiones en materia de planeación y políticas públicas. La Encuesta Origen–Destino 2017 proporciona información detallada sobre los hábitos de transporte de la población en México, lo que abre la posibilidad de aplicar enfoques estadísticos avanzados para modelar las relaciones entre variables sociodemográficas, espaciales y de transporte.

En este trabajo se propone el uso de redes bayesianas multinomiales como marco de análisis. Estas redes permiten representar relaciones de dependencia entre variables categóricas a través de grafos acíclicos dirigidos (DAG), ofreciendo no solo una estructura visual de dichas relaciones, sino también la capacidad de realizar inferencias probabilísticas bajo condiciones específicas.

La construcción del modelo se llevó a cabo de dos maneras: (1) mediante el diseño de una estructura basada en conocimiento previo y (2) utilizando un enfoque de aprendizaje automático con el algoritmo de hill climbing. Posteriormente, ambos modelos fueron evaluados con criterios de información (AIC y BIC) para seleccionar la estructura con mejor desempeño. Una vez identificado el modelo más adecuado, se realizaron consultas condicionales con el fin de explorar preguntas relevantes, como la relación entre el propósito del viaje y el uso del transporte público, o la influencia del tamaño de la localidad en la duración de los viajes.

Este enfoque no solo permite identificar patrones empíricos en los datos, sino también aportar una herramienta flexible para el análisis probabilístico de la movilidad urbana.

### Metodología

El trabajo sigue un enfoque cuantitativo, de modelado estadistico y probabilistico, utiizando redes bayesianas multinomiales para representar relaciones de dependencia entre las variables seleccionadas para resolver las queries.

A partir de las queries proporcionadas, se analizaron para determinar que variables tendriamos que extraer de la base de datos de la encuesta Origen-Destino 2017. Una vez seleccionadas estas variables, fueron procesadas en -- para poder trabajar con estos datos. Se construyeron dos gráficos acíclicos dirigidos, tambien conocidos como DAG, uno basado en conocimiento previo y otro generado con un algoritmo de optimizacion. Se compararon las dos DAGs usando metricas estadisticas y, realizando un ajuste de parametros con la mejor de las dos, se calcularon las queries.

Las principales tecnicas empleadas para realizar este articulo fueron:\
-Análisis de redes bayesianas, construyendo grafos acíclicos dirigidos para modelar relaciones de dependencia entre variables categoricas\
-Algoritmos de optimizacion, especificamente hill climbing, como generador de una DAG\
-Evaluacion de modelos, usando metodos estadisticos como el Criterio de Informacion de AKaike y el Criterio de Informacion Bayesiano, AIC y BIC por sus siglas en ingles.\
-Inferencia probabilistica, consultas condicionales para estimar probabilidades bajo evidencia

Los materiales utilizados para realizar este analisis fueron los siguientes:\
data.csv - los datos procesados\
tviaje.csv y tsdem.csv - los datos preprocesados\
eod_2017_csv.zip - El conjunto completo de datos de la encuensta Origen-Destino 2017

Las herramientas que utilizamos fueron las siguientes:\
Lenguaje de programacion R\
Librerias: dplyr, bnlearn, Rgraphviz\
Entorno de trabajo R Studio

### Aplicación

Aplicación: Muestra la implementación práctica de la metodología o la solución propuesta, incluyendo la descripción de los datos, experimentos o simulaciones, modelación y validación. Se presentan resultados obtenidos, se analizan y se discuten.

```{r}
library(bnlearn)

data = read.csv("data (1).csv", stringsAsFactors = TRUE)
head(data)
```

La base de datos que estamos utilizando cuenta con 7 columnas, categorizadas de la siguiente manera\
sexo: hombre y mujer\
tiempo - Duracion total del viaje: entre30y60, mayor60 y menor30\\ transporte\
Tipo de transporte utilizado: publico, privado y otro\
dia - Dia en el que se realizo el viaje: entreSemana y finDeSemana\
proposito - Proposito del viaje\\ viajes - Cantidad de viajes que realiza el hogar de la persona que realiza el viaje: pocos y muchos\
localidad - Tamano de la localidad donde se realiza el viaje: pequeña y grande

Creacion de la Dag usando hill climbing

```{r}
dag = empty.graph(nodes = c("sexo", "tiempo", "transporte", "dia", "proposito", "viajes", "localidad"))
```

```{r}
hc_dag = hc(data)
```

```{r}
modelstring(hc_dag)
```

```{r}
graphviz.plot(hc_dag, shape = "ellipse")
```

Evaluacion de la DAG creada

```{r}
score(hc_dag, data = data, type = "bic")
```

```{r}
score(hc_dag, data = data, type = "aic")
```

Creacion de la DAG utilizando conocimiento previo

```{r}
new_dag = empty.graph(nodes = c("sexo", "tiempo", "transporte", "dia", "proposito", "viajes", "localidad"))
```

```{r}
arc_set = matrix(c("sexo", "proposito",
                   "sexo", "transporte",
                   "localidad", "transporte",
                   "proposito", "dia",
                   "transporte", "tiempo",
                   "localidad", "tiempo",
                   "dia", "viajes",
                   "tiempo", "viajes"), byrow = TRUE, ncol = 2,
                 dimnames = list(NULL, c("from", "to")))
```

```{r}
arcs(new_dag) = arc_set
```

```{r}
graphviz.plot(new_dag, shape = "ellipse")
```

Evaluacion de la DAG creada

```{r}
score(new_dag, data = data, type = "bic")
```

```{r}
score(new_dag, data = data, type = "aic")
```

hc dag\
-2787909 aic\
-2791118 bic

manual dag\
-2839815 aic\
-2839038 bic\
Como podemos observar, el puntaje de la DAG generada con hill climbing, tanto con AIC como con BIC es superior, por lo que concluimos que es un mejor modelo, y sera el que utilicemos para realizar la inferencia probabilistca.

```{r}
bn = bn.fit(hc_dag, data = data)
```

Calculo de las consultas condicionales

Query 1: Cual es la probabilidad de que un hombre use el transporte publico cuando su destino es trabajo

```{r}
cpquery(bn, event = (transporte == "publico"), evidence = (proposito == "trabajo" & sexo == "hombre"), n = 10^6)
```

Query 2: Cual es la probabilidad de que le tiempo de viaje sea menor a 30 minutos dado que el viaje se hizo entre semana

```{r}
cpquery(bn, event = (tiempo == "menor30"), evidence = (dia == "entreSemana"), n = 10^6)
```

Query 3: Cual es la probabilidad de que las personas que habitan en localidades pequenas realices viajes mayores a 60 minutos frente a quienes habitan localidades grandes

```{r}
cpquery(bn, event = (localidad == "pequeña"), evidence = (tiempo == "mayor60"), n = 10^6)
```

```{r}
cpquery(bn, event = (localidad == "grande"), evidence = (tiempo == "mayor60"), n = 10^6)
```
La probabilidad de que alguien realice un viaje mayor a 60 min es mucho más alta en localidades pequeñas que en localidades grandes, siendo casi del 95% en las localidades pequeñas, mientras que en las grandes apenas un tercio de 1% de la población lo hace.

Query 4: Cual es la probabilidad de que los hogares con muchos viajes en localidades grandes, utilicen transporte publico o privado

```{r}
cpquery(
  bn,
  event = (viajes == "medios"),
  evidence = (localidad == "grande" & (transporte == "publico" | transporte == "privado")),
  n = 10^6
)
```

### Conclusiones

Conclusiones: Resume los hallazgos principales del estudio y su relevancia. Se destacan las implicaciones del trabajo, posibles limitaciones y sugerencias para investigaciones futuras o mejoras.

### Referencias

Referencias: Lista completa de todas las fuentes bibliográficas citadas en el artículo.
